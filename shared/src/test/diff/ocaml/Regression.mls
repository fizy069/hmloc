:AllowTypeErrors



let test =
  let f x = x in
  (f 1 + f true)
//│ test: int
//│ UERR 1 errors
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']

// TODO: show error
let test2 = let (a, b) = test in [[b]] + 1
//│ test2: int
//│ UERR 1 errors
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']

// TODO: show error
let f x = x + 1
not (f 1)
//│ f: int -> int
//│ res: bool
//│ UERR 1 errors
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']

// TODO: show error
:d
let a = 1
not a
//│ 1. Typing term 1
//│ 1. : int
//│ ⬤ Typed as: int
//│  where: 
//│ 0. Typing term not a
//│ | 0. Typing term not
//│ | 0. : [(bool -> bool)]
//│ | 0. Typing term a
//│ | 0. : [int]
//│ | CONSTRAIN [int] <! bool
//│ |   where 
//│ | C [int] <! bool    (0) where ProvType <: TypeRef}
//│ | | C int <! bool    (0) where TypeRef <: TypeRef}
//│ | | | !! COLLISION ERROR (List(int, [int]),List(bool))
//│ 0. : [bool]
//│ ⬤ Typed as: [bool]
//│  where: 
//│ a: int
//│ res: bool
//│ UERR 1 errors
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']


let confluence z = if true then z else 5
confluence true
//│ confluence: 'a -> (int | 'a)
//│ res: bool | int
//│ UERR 2 errors
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']


let x: int list
let y: string list
let f: string list -> unit
//│ x: list[int]
//│ y: list[string]
//│ f: list[string] -> unit
//│ UERR 2 errors
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']

// TODO: this won't show error because there are no type variables
f x
//│ UERR 2 errors
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']

// Should show
// ╔══[ERROR] Type `string list` does not match `int list`
// ║  
// ╟──        string list ---> ?a <--- int list 
// ║  
// ╟── `string list` comes from this type expression
// ║  l.-10: 	let y: string list
// ║         	       ^^^^^^^^^^^
// ╟── this `else` branch has type `string list` and it flows into `?a`
// ║  l.1: 	if true then x else y
// ║       	                    ^
// ╟── this if-then-else expression has type `?a`
// ║  l.1: 	if true then x else y
// ║       	^^^^^^^^^^^^^^^^^^^^^
// ╟── this `then` branch has type `?a` and it flows from `int list`
// ║  l.1: 	if true then x else y
// ║       	             ^
// ╟── this applied type reference has type `int list`
// ║  l.-11: 	let x: int list
// ╙──       	       ^^^^^^^^
// res: list[int | string]
if true then x else y
//│ res: list[int | string]
//│ UERR 3 errors
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [int ~ string, [int - list[int] ~ list[string] - string, [[[list[int]]]] <: α104, [[[list[string]]]] <: α104]]
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']

// TODO: show error
Left 1 : int
//│ res: int
//│ UERR 3 errors
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [int ~ string, [int - list[int] ~ list[string] - string, [[[list[int]]]] <: α104, [[[list[string]]]] <: α104]]
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']


let confluence z = if true then z else 5
let mkpair x y = (x, confluence y)
mkpair 1 "2"
//│ confluence: 'a -> (int | 'a)
//│ mkpair: 'a -> 'b -> ('a, int | 'b,)
//│ res: (int, int | string,)
//│ UERR 5 errors
//│ [int ~ [[string]], [[int]] <: α130, α129 <: [[[[[α130]]]]], [[[α129]]] <: α131, [[[α129]]] <: α131, [[string]] <: α129]
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [int ~ string, [int - list[int] ~ list[string] - string, [[[list[int]]]] <: α104, [[[list[string]]]] <: α104]]
//│ [int ~ [[string]], [[int]] <: α130, [[[α131]]] <: α130, [[[α129]]] <: α131, [[string]] <: α129]
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']

// TODO nested prov not shown in collision error
let a = 1
let b = a
let f x = if x then true else false
let g = f
g b
//│ a: int
//│ b: int
//│ bool -> bool
//│   <:  f:
//│ list[string] -> unit
//│ g: list[string] -> unit
//│ UERR 5 errors
//│ [int ~ [[string]], [[int]] <: α130, α129 <: [[[[[α130]]]]], [[[α129]]] <: α131, [[[α129]]] <: α131, [[string]] <: α129]
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [int ~ string, [int - list[int] ~ list[string] - string, [[[list[int]]]] <: α104, [[[list[string]]]] <: α104]]
//│ [int ~ [[string]], [[int]] <: α130, [[[α131]]] <: α130, [[[α129]]] <: α131, [[string]] <: α129]
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']

let wrap x = x :: []
  
// TODO: show error
if true then wrap 1 else wrap true
//│ wrap: 'a -> list['a]
//│ UERR 5 errors
//│ [int ~ [[string]], [[int]] <: α130, α129 <: [[[[[α130]]]]], [[[α129]]] <: α131, [[[α129]]] <: α131, [[string]] <: α129]
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [int ~ string, [int - list[int] ~ list[string] - string, [[[list[int]]]] <: α104, [[[list[string]]]] <: α104]]
//│ [int ~ [[string]], [[int]] <: α130, [[[α131]]] <: α130, [[[α129]]] <: α131, [[string]] <: α129]
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']


if true then wrap (if true then 1 else false) else wrap true
//│ res: list[bool | int]
//│ UERR 9 errors
//│ [int ~ [[string]], [[int]] <: α130, α129 <: [[[[[α130]]]]], [[[α129]]] <: α131, [[[α129]]] <: α131, [[string]] <: α129]
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [int ~ string, [int - list[int] ~ list[string] - string, [[[list[int]]]] <: α104, [[[list[string]]]] <: α104]]
//│ [bool ~ [[[int]]], [[[[bool]]]] <: α155, [[[int]]] <: α155]
//│ [bool ~ [[[int]]], [[[[[[bool]]]]]] <: 'a156, [[[α155]]] <: 'a156, [[[int]]] <: α155]
//│ [int ~ [[[bool]]], [[int]] <: α158, [[[bool]]] <: α158]
//│ [int ~ [[[bool]]], [[[[[int]]]]] <: 'a156, ['a156 - list['a156] ~ list['a161] - 'a161, [[[[list['a156]]]]] <: α154, [[[[list['a161]]]]] <: α154], [[[α160]]] <: 'a161, [[[bool]]] <: α160]
//│ [int ~ [[string]], [[int]] <: α130, [[[α131]]] <: α130, [[[α129]]] <: α131, [[string]] <: α129]
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']


let rec t = wrap (if true then 1 else t)
//│ t: 't
//│   where
//│     't :> list[int | 't]
//│ UERR 13 errors
//│ [int ~ string, [int - list[int] ~ list[string] - string, [[[list[int]]]] <: α104, [[[list[string]]]] <: α104]]
//│ [int ~ [[[[list['a174']]]]], [[[int]]] <: α173', t172' <: [[[[α173']]]], t172' <: [[[α176']]], [[[t172']]] <: α176', [[[[list['a174']]]]] <: t172']
//│ [int ~ [[[[list['a174']]]]], [[int]] <: α176', t172' <: [[[α176']]], [[[[t172']]]] <: α173', [[[[t172']]]] <: α173', [[[[list['a174']]]]] <: t172']
//│ [bool ~ [[[int]]], [[[[bool]]]] <: α155, [[[int]]] <: α155]
//│ [int ~ [[[[list['a174']]]]], [[int]] <: α176', [[[t172']]] <: α176', [[[[list['a174']]]]] <: t172']
//│ [int ~ [[string]], [[int]] <: α130, α129 <: [[[[[α130]]]]], [[[α129]]] <: α131, [[[α129]]] <: α131, [[string]] <: α129]
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [bool ~ [[[int]]], [[[[[[bool]]]]]] <: 'a156, [[[α155]]] <: 'a156, [[[int]]] <: α155]
//│ [int ~ [[[[list['a174']]]]], [[int]] <: α176', t172' <: [[[α176']]], [[[[[[t172']]]]]] <: 'a174', [[[α173']]] <: 'a174', [[[[t172']]]] <: α173', [[[[list['a174']]]]] <: t172']
//│ [int ~ [[[bool]]], [[int]] <: α158, [[[bool]]] <: α158]
//│ [int ~ [[[bool]]], [[[[[int]]]]] <: 'a156, ['a156 - list['a156] ~ list['a161] - 'a161, [[[[list['a156]]]]] <: α154, [[[[list['a161]]]]] <: α154], [[[α160]]] <: 'a161, [[[bool]]] <: α160]
//│ [int ~ [[string]], [[int]] <: α130, [[[α131]]] <: α130, [[[α129]]] <: α131, [[string]] <: α129]
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']


let test z = if true then wrap z else wrap true
 
let rec m = test (if true then 1 else m)
//│ test: 'a -> list[bool | 'a]
//│ m: 'm
//│   where
//│     'm :> list[int | 'm | bool]
//│ UERR 43 errors
//│ [int ~ string, [int - list[int] ~ list[string] - string, [[[list[int]]]] <: α104, [[[list[string]]]] <: α104]]
//│ [int ~ [[[[list['a174']]]]], [[[int]]] <: α173', t172' <: [[[[α173']]]], t172' <: [[[α176']]], [[[t172']]] <: α176', [[[[list['a174']]]]] <: t172']
//│ [int ~ [[[[list['a174']]]]], [[int]] <: α176', t172' <: [[[α176']]], [[[[t172']]]] <: α173', [[[[t172']]]] <: α173', [[[[list['a174']]]]] <: t172']
//│ [int ~ [[[[[[list['a212']]]]]]], [[int]] <: α215', [[[m206']]] <: α215', [[[[[[list['a212']]]]]]] <: m206']
//│ [bool ~ [[[[[[list['a208']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[[list['a212']]]]]]]]]] <: α207', m206' <: [[[[α207']]]], [[[m206']]] <: α215', [[[m206']]] <: α215', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [int ~ [[[[[[list['a208']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[m206']]]] <: α207', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [int ~ [[[[list['a174']]]]], [[int]] <: α176', [[[t172']]] <: α176', [[[[list['a174']]]]] <: t172']
//│ [bool ~ [[[[[[list['a208']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [bool ~ [[[[[[list['a208']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [int ~ [[[[[[list['a208']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [bool ~ [[int]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[α211']]] <: m206', α211' <: [[[[[α215']]]]], [[int]] <: α215']
//│ [int ~ [[[[[[list['a212']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[m206']]]] <: α207', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [int ~ [[string]], [[int]] <: α130, α129 <: [[[[[α130]]]]], [[[α129]]] <: α131, [[[α129]]] <: α131, [[string]] <: α129]
//│ [list['a208'] ~ [[[bool]]], [[[[[[[[list['a208']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', ['a208' - list['a208'] ~ list['a212'] - 'a212', [[[[list['a208']]]]] <: α211', [[[[list['a212']]]]] <: α211'], [[[α214']]] <: 'a212', [[[bool]]] <: α214']
//│ [int ~ [[[[[[list['a208']]]]]]], [[[[[[[int]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', α211' <: [[[[[[[[α210']]]]]]]], α211' <: [[[m206']]], [[[[[[list['a208']]]]]]] <: m206']
//│ [bool ~ [[[int]]], [[[[[[bool]]]]]] <: 'a156, [[[α155]]] <: 'a156, [[[int]]] <: α155]
//│ [bool ~ [[[[[[list['a208']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[list['a212']]]]]]] <: m206', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [int ~ [[string]], [[int]] <: α130, [[[α131]]] <: α130, [[[α129]]] <: α131, [[string]] <: α129]
//│ [bool ~ [[int]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[m206']]]] <: α207', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[α211']]] <: m206', α211' <: [[[[[α215']]]]], [[int]] <: α215']
//│ [list['a208'] ~ [[[int]]], [[[[[[list['a208']]]]]]] <: m206', [[[α211']]] <: m206', α211' <: [[[[[[[[α210']]]]]]]], [[[α207']]] <: α210', [[[int]]] <: α207']
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']
//│ [int ~ [[[[[[list['a208']]]]]]], [[int]] <: α215', [[[m206']]] <: α215', [[[[[[list['a208']]]]]]] <: m206']
//│ [list['a212'] ~ [[[bool]]], [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', ['a208' - list['a208'] ~ list['a212'] - 'a212', [[[[list['a208']]]]] <: α211', [[[[list['a212']]]]] <: α211'], [[[α214']]] <: 'a212', [[[bool]]] <: α214']
//│ [int ~ [[[[[[list['a208']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [bool ~ [[[int]]], [[[[bool]]]] <: α155, [[[int]]] <: α155]
//│ [int ~ [[[[[[list['a212']]]]]]], [[[[[[[int]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', α211' <: [[[[[[[[α210']]]]]]]], α211' <: [[[m206']]], [[[[[[list['a212']]]]]]] <: m206']
//│ [bool ~ [[[[[[list['a212']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [bool ~ [[int]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[α211']]] <: m206', α211' <: [[[[[α215']]]]], [[int]] <: α215']
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [int ~ [[[bool]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', ['a208' - list['a208'] ~ list['a212'] - 'a212', [[[[list['a208']]]]] <: α211', [[[[list['a212']]]]] <: α211'], [[[α214']]] <: 'a212', [[[bool]]] <: α214']
//│ [bool ~ [[[[[[list['a212']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[[list['a212']]]]]]]]]] <: α207', m206' <: [[[[α207']]]], [[[m206']]] <: α215', [[[m206']]] <: α215', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [bool ~ [[[[[[list['a208']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[m206']]]] <: α207', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [int ~ [[[[list['a174']]]]], [[int]] <: α176', t172' <: [[[α176']]], [[[[[[t172']]]]]] <: 'a174', [[[α173']]] <: 'a174', [[[[t172']]]] <: α173', [[[[list['a174']]]]] <: t172']
//│ [int ~ [[[bool]]], [[int]] <: α158, [[[bool]]] <: α158]
//│ [bool ~ [[[[[[list['a212']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[m206']]]] <: α207', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [int ~ [[[bool]]], [[[[[int]]]]] <: 'a156, ['a156 - list['a156] ~ list['a161] - 'a161, [[[[list['a156]]]]] <: α154, [[[[list['a161]]]]] <: α154], [[[α160]]] <: 'a161, [[[bool]]] <: α160]
//│ [int ~ [[[[[[list['a212']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [list['a212'] ~ [[[int]]], [[[[[[list['a212']]]]]]] <: m206', [[[α211']]] <: m206', α211' <: [[[[[[[[α210']]]]]]]], [[[α207']]] <: α210', [[[int]]] <: α207']
//│ [bool ~ [[int]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[list['a212']]]]]]] <: m206', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[α211']]] <: m206', α211' <: [[[[[α215']]]]], [[int]] <: α215']
//│ [bool ~ [[[[[[list['a212']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[list['a212']]]]]]] <: m206', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [bool ~ [[int]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[[list['a212']]]]]]]]]] <: α207', m206' <: [[[[α207']]]], [[[m206']]] <: α215', [[[m206']]] <: α215', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[α211']]] <: m206', α211' <: [[[[[α215']]]]], [[int]] <: α215']
//│ [int ~ [[[[[[list['a212']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [bool ~ [[[[[[list['a212']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']


// FIXME implementation exception
let rec digitsOfInt n =
  ((digitsOfInt n) / 10) @ [remainder];;
//│ ╔══[ERROR] identifier not found: remainder
//│ ║  
//│ ║  l.249:	  ((digitsOfInt n) / 10) @ [remainder];;
//│ ╙──      	                            ^^^^^^^^^
//│ digitsOfInt: anything -> list[error]
//│ UERR 46 errors
//│ [int ~ string, [int - list[int] ~ list[string] - string, [[[list[int]]]] <: α104, [[[list[string]]]] <: α104]]
//│ [int ~ [[[[list['a174']]]]], [[[int]]] <: α173', t172' <: [[[[α173']]]], t172' <: [[[α176']]], [[[t172']]] <: α176', [[[[list['a174']]]]] <: t172']
//│ [int ~ [[[[list['a174']]]]], [[int]] <: α176', t172' <: [[[α176']]], [[[[t172']]]] <: α173', [[[[t172']]]] <: α173', [[[[list['a174']]]]] <: t172']
//│ [int ~ [[[[[[list['a212']]]]]]], [[int]] <: α215', [[[m206']]] <: α215', [[[[[[list['a212']]]]]]] <: m206']
//│ [error<> ~ [[error<>]], [[error<>]] <: 'a238', [[error<>]] <: 'a238']
//│ [bool ~ [[[[[[list['a208']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[[list['a212']]]]]]]]]] <: α207', m206' <: [[[[α207']]]], [[[m206']]] <: α215', [[[m206']]] <: α215', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [int ~ [[[[[[list['a208']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[m206']]]] <: α207', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [int ~ [[[[list['a174']]]]], [[int]] <: α176', [[[t172']]] <: α176', [[[[list['a174']]]]] <: t172']
//│ [bool ~ [[[[[[list['a208']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [bool ~ [[[[[[list['a208']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [int ~ [[[[[[list['a208']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [bool ~ [[int]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[α211']]] <: m206', α211' <: [[[[[α215']]]]], [[int]] <: α215']
//│ [int ~ [[[[[[list['a212']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[m206']]]] <: α207', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [int ~ [[string]], [[int]] <: α130, α129 <: [[[[[α130]]]]], [[[α129]]] <: α131, [[[α129]]] <: α131, [[string]] <: α129]
//│ [list['a208'] ~ [[[bool]]], [[[[[[[[list['a208']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', ['a208' - list['a208'] ~ list['a212'] - 'a212', [[[[list['a208']]]]] <: α211', [[[[list['a212']]]]] <: α211'], [[[α214']]] <: 'a212', [[[bool]]] <: α214']
//│ [int ~ [[[[[[list['a208']]]]]]], [[[[[[[int]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', α211' <: [[[[[[[[α210']]]]]]]], α211' <: [[[m206']]], [[[[[[list['a208']]]]]]] <: m206']
//│ [bool ~ [[[int]]], [[[[[[bool]]]]]] <: 'a156, [[[α155]]] <: 'a156, [[[int]]] <: α155]
//│ [error<> ~ [[error<>]], [[[error<>]]] <: α232', 'a239' <: [[α232']], 'a239' <: ['a238'], [[error<>]] <: 'a238']
//│ [bool ~ [[[[[[list['a208']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[list['a212']]]]]]] <: m206', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [int ~ [[string]], [[int]] <: α130, [[[α131]]] <: α130, [[[α129]]] <: α131, [[string]] <: α129]
//│ [bool ~ [[int]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[m206']]]] <: α207', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[α211']]] <: m206', α211' <: [[[[[α215']]]]], [[int]] <: α215']
//│ [list['a208'] ~ [[[int]]], [[[[[[list['a208']]]]]]] <: m206', [[[α211']]] <: m206', α211' <: [[[[[[[[α210']]]]]]]], [[[α207']]] <: α210', [[[int]]] <: α207']
//│ [int ~ [[[bool]]], [[int]] <: α67', [[[bool]]] <: α67']
//│ [int ~ [[[[[[list['a208']]]]]]], [[int]] <: α215', [[[m206']]] <: α215', [[[[[[list['a208']]]]]]] <: m206']
//│ [list['a212'] ~ [[[bool]]], [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', ['a208' - list['a208'] ~ list['a212'] - 'a212', [[[[list['a208']]]]] <: α211', [[[[list['a212']]]]] <: α211'], [[[α214']]] <: 'a212', [[[bool]]] <: α214']
//│ [int ~ [[[[[[list['a208']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [bool ~ [[[int]]], [[[[bool]]]] <: α155, [[[int]]] <: α155]
//│ [int ~ [[[[[[list['a212']]]]]]], [[[[[[[int]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', α211' <: [[[[[[[[α210']]]]]]]], α211' <: [[[m206']]], [[[[[[list['a212']]]]]]] <: m206']
//│ [error<> ~ [[error<>]], [[error<>]] <: 'a238', 'a239' <: ['a238'], [['a239']] <: α232', [['a239']] <: α232', 'a239' <: ['a238'], [[error<>]] <: 'a238']
//│ [bool ~ [[[[[[list['a212']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [bool ~ [[int]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[α211']]] <: m206', α211' <: [[[[[α215']]]]], [[int]] <: α215']
//│ [int ~ [[[bool]]], [[int]] <: α99, [[[α98]]] <: α99, [[[bool]]] <: α98]
//│ [int ~ [[[bool]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', ['a208' - list['a208'] ~ list['a212'] - 'a212', [[[[list['a208']]]]] <: α211', [[[[list['a212']]]]] <: α211'], [[[α214']]] <: 'a212', [[[bool]]] <: α214']
//│ [bool ~ [[[[[[list['a212']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[[list['a212']]]]]]]]]] <: α207', m206' <: [[[[α207']]]], [[[m206']]] <: α215', [[[m206']]] <: α215', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [bool ~ [[[[[[list['a208']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[m206']]]] <: α207', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206']
//│ [int ~ [[[[list['a174']]]]], [[int]] <: α176', t172' <: [[[α176']]], [[[[[[t172']]]]]] <: 'a174', [[[α173']]] <: 'a174', [[[[t172']]]] <: α173', [[[[list['a174']]]]] <: t172']
//│ [int ~ [[[bool]]], [[int]] <: α158, [[[bool]]] <: α158]
//│ [bool ~ [[[[[[list['a212']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[m206']]]] <: α207', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [int ~ [[[bool]]], [[[[[int]]]]] <: 'a156, ['a156 - list['a156] ~ list['a161] - 'a161, [[[[list['a156]]]]] <: α154, [[[[list['a161]]]]] <: α154], [[[α160]]] <: 'a161, [[[bool]]] <: α160]
//│ [int ~ [[[[[[list['a212']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', α207' <: [[[[['a208']]]]], [[[α207']]] <: α210', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [list['a212'] ~ [[[int]]], [[[[[[list['a212']]]]]]] <: m206', [[[α211']]] <: m206', α211' <: [[[[[[[[α210']]]]]]]], [[[α207']]] <: α210', [[[int]]] <: α207']
//│ [bool ~ [[int]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[list['a212']]]]]]] <: m206', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[α211']]] <: m206', α211' <: [[[[[α215']]]]], [[int]] <: α215']
//│ [bool ~ [[[[[[list['a212']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[list['a212']]]]]]] <: m206', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [bool ~ [[int]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[[list['a212']]]]]]]]]] <: α207', m206' <: [[[[α207']]]], [[[m206']]] <: α215', [[[m206']]] <: α215', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[α211']]] <: m206', α211' <: [[[[[α215']]]]], [[int]] <: α215']
//│ [int ~ [[[[[[list['a212']]]]]]], [[int]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
//│ [bool ~ [[[[[[list['a212']]]]]]], [[[[[bool]]]]] <: 'a212', ['a212' - list['a212'] ~ list['a208'] - 'a208', [[[[[[[[list['a212']]]]]]]]] <: α215', m206' <: [[[α215']]], [[[[[[[[m206']]]]]]]] <: 'a208', [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a208']]]]]]] <: m206'], [[[α210']]] <: 'a208', [[[α207']]] <: α210', [[[[m206']]]] <: α207', [[[[[[list['a212']]]]]]] <: m206']
